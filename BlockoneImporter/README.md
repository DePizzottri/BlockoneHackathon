# Blockone Hackathon

Импорт и индексация транзакций из сети Ethereum в MongoDB посредством gRPC

## Требования к сборке
Необходимо установить JDK 1.8
SBT
MongoDB 3.2+

## Сборка и настройка
Конфигурацию MongoDB можно использовать по умолчанию. 
Единственным условием является наличие достаточной оперативной памяти для индексов и соответственно заданный кэш.
Можно также воспользоваться приведеной конфигурацией:
```
cd mongo
mongod -f mongo.conf &
```
Программа импорта как таковой сборки не требует.

## Запуск
```
./start_import.sh http://localhost:8545/ localhost 0 10000
```
где параметры это:
* адрес gRPC geth
* хост MongoDB
* номер начального блока для импорта
* номер последнего блока для импорта

Для ускорения возможно осуществлять параллельный импорт, разбив количество блоков на несколько непересекающихся частей, и запустив программу иморта параллельно:
```
./start_import.sh http://localhost:8545/ localhost 0 10000 > /dev/null
./start_import.sh http://localhost:8545/ localhost 10001 20000 > /dev/null 
./start_import.sh http://localhost:8545/ localhost 20001 30000 > /dev/null
...
```

После окончания импорта необходимо построить индексы
```
mongo
> use ethereum
> db.txs.createIndex({from:1}, {unique:false})
> db.txs.createIndex({to:1}, {unique:false})
```

## Иморт тестовой сети Rinkeby
Конфигурация тестовой машины:
* Core i5 4670, 28 Gb RAM, 2 Tb WD Black
* Geth/v1.8.12
* MongoDB 3.6

Архив с дампом тестовой базы можно скачать отсюда https://www.dropbox.com/s/m363fbyroadzs43/dump.tar.gz

6 параллельных импортеров загрузили в базу 12 млн. из транзакций тестовой сети менее чем за 1 час, что соответствует cкорости ~3к tx/sec.

## Импорт основной сети
Дополнительная тестовая машина
* Core i5 3570, 32 Gb RAM, 2 Tb WD Black
* Geth/v1.8.12

По 6 параллельных импортеров на каждую машину загрузили 270 млн. транзакций основной сети в базу за 9 часов, со скоростью ~8.3к tx/sec.

Учитывая огромное время, требуемое на первичную синхронизацию, предлагаемый способ импорта транзакций по временным и материальным затратам считается автором более чем приемлемым.